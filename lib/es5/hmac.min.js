"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Date.now||(Date.now=function(){return(new Date).getTime()}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(o){if("object"!==("undefined"==typeof o?"undefined":_typeof(o))&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");var a,i,s=[];for(a in o)e.call(o,a)&&s.push(a);if(t)for(i=0;n>i;i++)e.call(o,r[i])&&s.push(r[i]);return s}}()),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var r,n;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),a=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(r=t),n=0;a>n;){var i;n in o&&(i=o[n],e.call(r,i,n,o)),n++}});var AcquiaHttpHmac=function(){function e(t){var r=t.realm,n=t.public_key,o=t.secret_key,a=t.version,i=void 0===a?"2.0":a,s=t.default_content_type,u=void 0===s?"application/json":s;if(_classCallCheck(this,e),!r)throw new Error('The "realm" must not be empty.');if(!n)throw new Error('The "public_key" must not be empty.');if(!o)throw new Error('The "secret_key" must not be empty.');var c=["2.0"];if(c.indexOf(i)<0)throw new Error('The version must be "'+c.join('" or "')+'". Version "'+i+'" is not supported.');var p=CryptoJS.enc.Base64.parse(o);this.config={realm:r,public_key:n,parsed_secret_key:p,version:i,default_content_type:u},this.SUPPORTED_METHODS=["GET","POST","PUT","DELETE","HEAD","OPTIONS","CUSTOM"]}return _createClass(e,[{key:"isXMLHttpRequest",value:function(e){return e instanceof XMLHttpRequest}},{key:"isPromiseRequest",value:function(e){return e.hasOwnProperty("setRequestHeader")&&e.hasOwnProperty("getResponseHeader")&&e.hasOwnProperty("promise")}},{key:"sign",value:function(e){var t=e.request,r=e.method,n=e.path,o=e.signed_headers,a=void 0===o?{}:o,i=e.content_type,s=void 0===i?this.config.default_content_type:i,u=e.body,c=void 0===u?"":u;if(!this.isXMLHttpRequest(t)&&!this.isPromiseRequest(t))throw new Error("The request must be a XMLHttpRequest or promise-based request Object (e.g. jqXHR).");if(this.SUPPORTED_METHODS.indexOf(r)<0)throw new Error('The method must be "'+this.SUPPORTED_METHODS.join('" or "')+'". "'+r+'" is not supported.');if(!n)throw new Error("The end point path must not be empty.");var p=function(e){var t=arguments.length<=1||void 0===arguments[1]?"=":arguments[1],r=arguments.length<=2||void 0===arguments[2]?"":arguments[2],n=arguments.length<=3||void 0===arguments[3]?"&":arguments[3],o=arguments.length<=4||void 0===arguments[4]?!0:arguments[4],a=Object.keys(e),i=[],s={},u=[];return a.forEach(function(t){if(e.hasOwnProperty(t)){var r=t.toLowerCase();i.push(r),s[r]=o?encodeURI(e[t]):e[t]}}),i.sort().forEach(function(e){s.hasOwnProperty(e)&&u.push(""+e+t+s[e]+r)}),u.join(n)},f=function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:7&r|8).toString(16)})},h=function(e,t){var r=["GET","HEAD"];return 0!==e.length&&r.indexOf(t)<0},y=f(),l=document.createElement("a"),m={id:this.config.public_key,nonce:y,realm:this.config.realm,version:this.config.version},d=Math.floor(Date.now()/1e3).toString(),g=h(c,r)?CryptoJS.SHA256(c).toString(CryptoJS.enc.Base64):"",v=h(c,r)?"\n"+s+"\n"+g:"";l.href=n;var H=l.port?":"+l.port:"",w=""+l.hostname+H,x=l.search.substring(1),b=p(a,":","","\n",!1),S=""===b?"":b+"\n",E=r+"\n"+w+"\n"+l.pathname+"\n"+x+"\n"+p(m)+"\n"+S+d+v,O=p(m,'="','"',","),_=encodeURI(Object.keys(a).join("|||||").toLowerCase().split("|||||").sort().join(";")),T=encodeURI(CryptoJS.HmacSHA256(E,this.config.parsed_secret_key).toString(CryptoJS.enc.Base64)),q="acquia-http-hmac "+O+',headers="'+_+'",signature="'+T+'"';this.isXMLHttpRequest(t)&&0===t.readyState&&t.open(r,n,!0),t.acquiaHttpHmac={},t.acquiaHttpHmac.timestamp=d,t.acquiaHttpHmac.nonce=y,t.setRequestHeader("X-Authorization-Timestamp",d),t.setRequestHeader("Authorization",q),g&&t.setRequestHeader("X-Authorization-Content-SHA256",g)}},{key:"hasValidResponse",value:function(e){var t=e.acquiaHttpHmac.nonce+"\n"+e.acquiaHttpHmac.timestamp+"\n"+e.responseText,r=CryptoJS.HmacSHA256(t,this.config.parsed_secret_key).toString(CryptoJS.enc.Base64),n=e.getResponseHeader("X-Server-Authorization-HMAC-SHA256");return r===n}}]),e}();if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))){var CryptoJS=require("crypto-js");module.exports=exports=AcquiaHttpHmac}else{if("function"==typeof define&&define.amd)throw new Error("Update here to support AMD.");window.AcquiaHttpHmac=AcquiaHttpHmac}