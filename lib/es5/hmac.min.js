"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Date.now||(Date.now=function(){return(new Date).getTime()});var AcquiaHttpHmac=function(){function e(t){var n=t.realm,r=t.public_key,o=t.secret_key,a=t.version,i=void 0===a?"2.0":a,s=t.default_content_type,c=void 0===s?"application/json":s;if(_classCallCheck(this,e),!n)throw new Error('The "realm" must not be empty.');if(!r)throw new Error('The "public_key" must not be empty.');if(!o)throw new Error('The "secret_key" must not be empty.');var u=["2.0"];if(u.indexOf(i)<0)throw new Error('The version must be "'+u.join('" or "')+'". Version "'+i+'" is not supported.');var p=CryptoJS.enc.Base64.parse(o);this.config={realm:n,public_key:r,parsed_secret_key:p,version:i,default_content_type:c},this.SUPPORTED_METHODS=["GET","POST","PUT","DELETE","HEAD","OPTIONS","CUSTOM"]}return _createClass(e,[{key:"sign",value:function(e){var t=e.request,n=e.method,r=e.path,o=e.signed_headers,a=void 0===o?{}:o,i=e.content_type,s=void 0===i?this.config.default_content_type:i,c=e.body,u=void 0===c?"":c;if(!(t instanceof XMLHttpRequest||"undefined"!=typeof MockHttpRequest&&t instanceof MockHttpRequest))throw new Error("The request must be a XMLHttpRequest.");if(this.SUPPORTED_METHODS.indexOf(n)<0)throw new Error('The method must be "'+this.SUPPORTED_METHODS.join('" or "')+'". "'+n+'" is not supported.');if(!r)throw new Error("The end point path must not be empty.");var p=function(e){var t=arguments.length<=1||void 0===arguments[1]?"=":arguments[1],n=arguments.length<=2||void 0===arguments[2]?"":arguments[2],r=arguments.length<=3||void 0===arguments[3]?"&":arguments[3],o=[];for(var a in e)e.hasOwnProperty(a)&&o.push(""+a+t+e[a]+n);return o.join(r)},h=function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:7&n|8).toString(16)})},m=function(e,t){var n=["GET","HEAD"];return 0!==e.length&&n.indexOf(t)<0},f=h(),l=document.createElement("a"),d={id:this.config.public_key,nonce:f,realm:this.config.realm,version:this.config.version},y=Math.floor(Date.now()/1e3).toString(),x=m(u,n)?CryptoJS.SHA256(u).toString(CryptoJS.enc.Base64):"",g=m(u,n)?"\n"+s+"\n"+x:"";l.href=r;var v=l.port?":"+l.port:"",H=""+l.hostname+v,S=l.search.substring(1),_=n+"\n"+H+"\n"+l.pathname+"\n"+S+"\n"+p(d)+"\n"+y+g,T=p(d,'="','"',","),w=0===Object.keys(a).length?"":',headers="'+Object.keys(a).join()+'"',E=CryptoJS.HmacSHA256(_,this.config.parsed_secret_key).toString(CryptoJS.enc.Base64),b="acquia-http-hmac "+T+',signature="'+E+'"'+w;t.acquiaHttpHmac={},t.acquiaHttpHmac.timestamp=y,t.acquiaHttpHmac.nonce=f,t.setRequestHeader("X-Authorization-Timestamp",y),t.setRequestHeader("Authorization",b),x&&t.setRequestHeader("X-Authorization-Content-SHA256",x)}},{key:"hasValidResponse",value:function(e){var t=e.acquiaHttpHmac.nonce+"\n"+e.acquiaHttpHmac.timestamp+"\n"+e.responseText,n=CryptoJS.HmacSHA256(t,this.config.parsed_secret_key).toString(CryptoJS.enc.Base64),r=e.getResponseHeader("X-Server-Authorization-HMAC-SHA256");return n===r}}]),e}();